`timescale 1ns / 1ps
module top_i2c_system(
    input  wire clk,
    input  wire start,
    input  wire mem_write,
    input  wire [31:0] address,
    input  wire [31:0] write_data,
    output wire done,
    output wire scl,
    output wire sda,
    output wire slave_sel
);

    // ===== Internal Wires =====
    wire ack_from_slave0;
    wire ack_from_slave1;

    // Common SDA line
    wire sda_line;
    assign sda = sda_line;

    // Pullups simulate I²C bus idle state
    pullup(sda_line);
    pullup(scl);

    // ===== Instantiate Master =====
    i2c_master master_inst (
        .clk(clk),
        .start(start),
        .address(address),
        .write_data(write_data),
        .ack_from_slave0(ack_from_slave0),
        .ack_from_slave1(ack_from_slave1),
        .mem_write(mem_write),
        .scl(scl),
        .sda(sda_line),
        .slave_sel(slave_sel),
        .done(done)
    );

    // ===== Instantiate Slave 0 =====
    i2c_slave slave0 (
        .clk(clk),
        .scl(scl),
        .sda(sda_line),
        .mem_write(mem_write),
        .data_out(),                // received data
        .data_in(32'hAAAA_BBBB),    // data to send for read
        .ack_out(ack_from_slave0)
    );

    // ===== Instantiate Slave 1 =====
    i2c_slave1 slave1 (
        .clk(clk),
        .scl(scl),
        .sda(sda_line),
        .mem_write(mem_write),
        .data_out(),                // received data
        .data_in(32'hCCCC_DDDD),    // data to send for read
        .ack_out(ack_from_slave1)
    );

endmodule
